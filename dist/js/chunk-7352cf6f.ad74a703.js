(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-7352cf6f"],{"0c23":function(e,t,i){},"0d03":function(e,t,i){var s=i("6eeb"),r=Date.prototype,a="Invalid Date",n="toString",o=r[n],c=r.getTime;new Date(NaN)+""!=a&&s(r,n,(function(){var e=c.call(this);return e===e?o.call(this):a}))},"109d":function(e,t,i){},"2d6f":function(e,t,i){"use strict";var s=i("0c23"),r=i.n(s);r.a},"4d38":function(e,t,i){e.exports=i.p+"img/speaker.46efd460.svg"},"6eba":function(e,t,i){var s=i("23e7");s({target:"Date",stat:!0},{now:function(){return(new Date).getTime()}})},"7a82":function(e,t,i){var s=i("23e7"),r=i("83ab"),a=i("9bf2");s({target:"Object",stat:!0,forced:!r,sham:!r},{defineProperty:a.f})},8363:function(e,t,i){"use strict";i.r(t);var s=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"play"},[e._m(0),i("NewMessage",{attrs:{name:e.name,jobs:e.jobs}}),e._l(e.messages,(function(t){return i("li",{key:t.id},[i("span",[e._v(e._s(t.name))]),i("span",[e._v(e._s(t.jobs))]),i("span",[e._v(e._s(t.content))]),i("span",[e._v(e._s(t.timestamp))])])})),i("transition",{attrs:{name:"fade"}},[i("div",{directives:[{name:"show",rawName:"v-show",value:!e.controlsEnabled,expression:"!controlsEnabled"}],ref:"blocker",attrs:{id:"blocker"}},[i("div",{ref:"instructions",attrs:{id:"instructions"},on:{click:e.clickOnInstructions}},[i("span",{staticStyle:{"font-size":"40px"}},[e._v("Click to play "+e._s(this.name)+" ")]),i("br"),e._v(" (W, A, S, D = Move, SPACE = Jump, MOUSE = Look aroundt) ")])])]),i("div",{staticClass:"controls"},[i("button",{on:{click:function(t){return e.movePosition(5,5,0)}}},[e._v("Move a")]),i("button",{on:{click:function(t){return e.movePosition(5,15,0)}}},[e._v("Move b")]),i("button",{on:{click:function(t){return e.movePosition(15,5,0)}}},[e._v("Move c")])]),i("div",{ref:"canvas",staticClass:"container"},[e._m(1)])],2)},r=[function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("section",{attrs:{id:"loading-screen"}},[s("div",{attrs:{id:"loader"}}),s("div",{staticClass:"lock"},[s("img",{attrs:{src:i("c2b0"),alt:"lock"}})])])},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"wrapper"},[s("div",{staticClass:"left-down"},[s("div",{staticClass:"map"},[s("img",{attrs:{src:i("c9eb"),alt:"Facebook_WeProvide"}})])]),s("div",{staticClass:"right-down"},[s("div",{staticClass:"fullscreen"},[s("img",{attrs:{src:i("c9eb"),alt:"Facebook_WeProvide"}})]),s("div",{staticClass:"sound"},[s("img",{attrs:{src:i("4d38"),alt:"Sound"}})])]),s("div",{staticClass:"center-down"},[s("div",{staticClass:"mouse m-1"})]),s("div",{staticClass:"top-right"},[s("div",{staticClass:"lock"},[s("img",{attrs:{src:i("ad78"),alt:"Lock"}})])]),s("div",{staticClass:"center"},[s("div",{staticClass:"marker"})])])}],a=(i("4160"),i("b0c0"),i("159b"),i("5a89")),n=i("83a1"),o=i.n(n);i("de11");function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}i("7a82");function h(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}function l(e,t,i){return t&&h(e.prototype,t),i&&h(e,i),e}var d=function(){function e(t,i,s){c(this,e),this.geometry=new a["BoxGeometry"](t,i,s),this.setVertexColors()}return l(e,[{key:"setVertexColors",value:function(){for(var e=0,t=this.geometry.faces.length;e<t;e++){var i=this.geometry.faces[e];i.vertexColors[0]=this.vertexColor(),i.vertexColors[1]=this.vertexColor(),i.vertexColors[2]=this.vertexColor()}return this}},{key:"vertexColor",value:function(){return(new a["Color"]).setHSL(.3*Math.random()+.5,.75,.25*Math.random()+.75)}},{key:"setMaterial",value:function(){return this.material=new a["MeshPhongMaterial"]({specular:16777215,flatShading:a["FlatShading"],vertexColors:a["VertexColors"]}),this.material.color.setHSL(.2*Math.random()+.5,.75,.25*Math.random()+.75),this}},{key:"setMesh",value:function(){return this.mesh=new a["Mesh"](this.geometry,this.material),this}},{key:"setPosition",value:function(e,t,i){return this.mesh.position.x=e,this.mesh.position.y=t,this.mesh.position.z=i,this}},{key:"create",value:function(){return this.setMaterial(),this.setMesh(),this}}]),e}(),u=i("34ad"),p=(i("3191"),i("a5cf")),m=i("4476"),f=i("9ce6"),g=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"new-message"},[i("form",{on:{submit:function(t){return t.preventDefault(),e.addMessage(t)}}},[i("label",{attrs:{for:"new-message"}},[e._v("New Message (enter to add):")]),i("input",{directives:[{name:"model",rawName:"v-model",value:e.newMessage,expression:"newMessage"}],attrs:{type:"text",name:"new-message"},domProps:{value:e.newMessage},on:{input:function(t){t.target.composing||(e.newMessage=t.target.value)}}}),e.feedback?i("p",[e._v(e._s(e.feedback))]):e._e()])])},v=[],b=(i("6eba"),i("0d03"),i("032d")),k={name:"NewMessage",props:["name","jobs"],data:function(){return{newMessage:null,feedback:null}},methods:{addMessage:function(){this.newMessage?b["a"].collection("messages").add({content:this.newMessage,name:this.name,jobs:this.jobs,timestamp:Date.now()})["catch"]((function(e){console.log(e)})):this.feedback="You must enter a message in order to send one"}}},w=k,x=(i("2d6f"),i("2877")),N=Object(x["a"])(w,g,v,!1,null,"716f741a",null),C=N.exports,_=i("c1df"),M=i.n(_);i("facd");m["a"].registerPlugin(f["a"]);var T={name:"Play",props:["name","jobs"],components:{NewMessage:C},data:function(){return{messages:[],element:void 0,camera:void 0,scene:void 0,box:void 0,renderer:void 0,controls:void 0,objects:[],raycaster:void 0,blocker:void 0,instructions:void 0,havePointerLock:void 0,intersects:[],loadingScreen:void 0,loadingManager:null,moveForward:!1,moveBackward:!1,moveLeft:!1,moveRight:!1,canJump:!1,sprinting:!1,moveY:0,prevTime:void 0,velocity:void 0}},created:function(){var e=this,t=b["a"].collection("messages").orderBy("timestamp");t.onSnapshot((function(t){t.docChanges().forEach((function(t){if("added"==t.type){var i=t.doc;e.messages.push({id:i.id,name:i.data().name,jobs:i.data().jobs,content:i.data().content,timestamp:M()(i.data().timestamp).format("ll")})}}))}))},methods:{init:function(){var e=this;this.camera=new a["PerspectiveCamera"](90,window.innerWidth/window.innerHeight,1,1e3),this.camera.position.set(0,30,0),console.log(this.camera.position),this.scene=new a["Scene"],this.scene.fog=new a["Fog"](16777215,0,750);var t=new a["HemisphereLight"](15658751,7829384,.75);t.position.set(.5,1,.75),this.scene.add(t),this.controls=new o.a(this.camera),this.scene.add(this.controls.getObject()),document.addEventListener("wheel",this.onScrollWheel,!1),document.addEventListener("keydown",this.onKeyDown,!1),document.addEventListener("keyup",this.onKeyUp,!1),this.raycaster=new a["Raycaster"](new a["Vector3"],new a["Vector3"](0,-1,0),0,10),this.loadingManager=new a["LoadingManager"]((function(){e.loadingScreen=document.getElementById("loading-screen"),e.loadingScreen.classList.add("fade-out"),e.loadingScreen.addEventListener("transitionend",e.onTransitionEnd)})),this.initCreateGround(),this.initCreateHouse(),this.initCube(),this.initRenderer(),window.addEventListener("resize",this.onWindowResize,!1)},initRenderer:function(){this.renderer=new a["WebGLRenderer"],this.renderer.gammaOutput=!0,this.renderer.gammaFactor=2.2,this.renderer.setClearColor(1381653),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(window.innerWidth,window.innerHeight),this.element.appendChild(this.renderer.domElement)},initCreateGround:function(){var e=this,t=new u["a"](this.loadingManager);t.load("/blender/grond.glb",(function(t){e.scene.add(t.scene),t.scene.position.set(0,0,-100),t.scene.scale.set(10,10,10)}),(function(e){console.log(e.loaded/e.total*100+"% loaded")}),(function(e){console.log("An error happened")}))},initCreateHouse:function(){var e=this,t=new u["a"](this.loadingManager);t.load("/blender/room.glb",(function(t){e.scene.add(t.scene),t.scene.position.set(0,15,0),t.scene.scale.set(8,8,8)}),(function(e){console.log(e.loaded/e.total*100+"% loaded")}),(function(e){console.log("An error happened")}))},initCube:function(){var e=this.scene.getObjectByName("Cube");e=new d(20,20,20).create().setPosition(10,10,10);var t=e.mesh;this.scene.add(t),this.objects.push(t)},animate:function(){if(requestAnimationFrame(this.animate),this.controlsEnabled){var e=performance.now(),t=(e-this.prevTime)/1e3;this.velocity.x-=10*this.velocity.x*t,this.velocity.z-=10*this.velocity.z*t,this.velocity.y-=9.8*100*t,this.handleInput(t),this.controls.getObject().position.y<10&&(this.velocity.y=0,this.controls.getObject().position.y=10,this.canJump=!0),this.prevTime=e}this.renderer.render(this.scene,this.camera)},onTransitionEnd:function(e){e.target.remove()},handleInput:function(e){this.velocity.z+=10*this.moveY*e,this.controls.getObject().position.z+=this.velocity.z*e,this.moveY=0},movePosition:function(e,t,i){this.controls.getObject().position.x=e,this.controls.getObject().position.y=t,this.controls.getObject().position.z=i},onKeyDown:function(e){switch(e.keyCode){case 38:case 87:this.moveForward=!0;break;case 37:case 65:this.moveLeft=!0;break;case 40:case 83:this.moveBackward=!0;break;case 39:case 68:this.moveRight=!0;break;case 32:!0===this.canJump&&(this.velocity.y+=350),this.canJump=!1;break;case 16:this.sprinting=!0;break}},onKeyUp:function(e){switch(e.keyCode){case 38:case 87:this.moveForward=!1;break;case 37:case 65:this.moveLeft=!1;break;case 40:case 83:this.moveBackward=!1;break;case 39:case 68:this.moveRight=!1;break;case 16:this.sprinting=!1;break}},onScrollWheel:function(e){var t=e.deltaY;t>0&&(this.moveY=1),t<0&&(this.moveY=-1),this.moveY=t},isOnObject:function(){this.raycaster.ray.origin.copy(this.controls.getObject().position),this.raycaster.ray.origin.y-=10;var e=this.raycaster.intersectObjects(this.objects);return e.length>0},onWindowResize:function(){this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(window.innerWidth,window.innerHeight)},pointerlockchange:function(){document.pointerLockElement===this.element||document.mozPointerLockElement===this.element||document.webkitPointerLockElement===this.element?this.controls.enabled=!0:this.controls.enabled=!1},pointerlockerror:function(){},clickOnInstructions:function(){this.element.requestPointerLock=this.element.requestPointerLock||this.element.mozRequestPointerLock||this.element.webkitRequestPointerLock,/Firefox/i.test(navigator.userAgent)?(document.addEventListener("fullscreenchange",this.fullscreenchange,!1),document.addEventListener("mozfullscreenchange",this.fullscreenchange,!1),this.element.requestFullscreen=this.element.requestFullscreen||this.element.mozRequestFullscreen||this.element.mozRequestFullScreen||this.element.webkitRequestFullscreen,this.element.requestFullscreen()):this.element.requestPointerLock()},fullscreenchange:function(){document.fullscreenElement!==this.element&&document.mozFullscreenElement!==this.element&&document.mozFullScreenElement!==this.element||(document.removeEventListener("fullscreenchange",this.fullscreenchange),document.removeEventListener("mozfullscreenchange",this.fullscreenchange),this.element.requestPointerLock())}},computed:{controlsEnabled:function(){return void 0!==this.controls&&this.controls.enabled},zInput:function(){var e=0;return e-=this.moveForward?1:0,e+=this.moveBackward?1:0,e},xInput:function(){var e=0;return e-=this.moveLeft?1:0,e+=this.moveRight?1:0,e},moveObjectA:function(){(this.camera.position.z=30)&&(this.controls.getObject().position.y=y)}},mounted:function(){this.element=this.$refs.canvas,this.blocker=this.$refs.blocker,this.instructions=this.$refs.instructions;new p["d"];this.prevTime=performance.now(),this.velocity=new a["Vector3"],"pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document?(document.addEventListener("pointerlockchange",this.pointerlockchange,!1),document.addEventListener("mozpointerlockchange",this.pointerlockchange,!1),document.addEventListener("webkitpointerlockchange",this.pointerlockchange,!1),document.addEventListener("pointerlockerror",this.pointerlockerror,!1),document.addEventListener("mozpointerlockerror",this.pointerlockerror,!1),document.addEventListener("webkitpointerlockerror",this.pointerlockerror,!1),this.init(),this.animate()):this.instructions.innerHTML="Your browser doesn't seem to support Pointer Lock API"}},j=T,A=(i("88e7"),Object(x["a"])(j,s,r,!1,null,"60cb8962",null));t["default"]=A.exports},"83a1":function(e,t,i){e.exports=function(e){var t=window.THREE||i("5a89"),s=this;e.rotation.set(0,0,0);var r=new t.Object3D;r.add(e);var a=new t.Object3D;a.position.y=10,a.add(r);var n=!1,o=!1,c=!1,h=!1,l=!1,d=!1,u=performance.now(),p=new t.Vector3,m=Math.PI/2,f=function(e){if(!1!==s.enabled){var t=e.movementX||e.mozMovementX||e.webkitMovementX||0,i=e.movementY||e.mozMovementY||e.webkitMovementY||0;a.rotation.y-=.002*t,r.rotation.x-=.002*i,r.rotation.x=Math.max(-m,Math.min(m,r.rotation.x))}},g=function(e){switch(e.keyCode){case 38:case 87:n=!0;break;case 37:case 65:c=!0;break;case 40:case 83:o=!0;break;case 39:case 68:h=!0;break;case 32:!0===d&&(p.y+=350),d=!1;break}},v=function(e){switch(e.keyCode){case 38:case 87:n=!1;break;case 37:case 65:c=!1;break;case 40:case 83:o=!1;break;case 39:case 68:h=!1;break}};document.addEventListener("mousemove",f,!1),document.addEventListener("keydown",g,!1),document.addEventListener("keyup",v,!1),this.enabled=!1,this.getObject=function(){return a},this.isOnObject=function(e){l=e,d=e},this.getDirection=function(){var e=new t.Vector3(0,0,-1),i=new t.Euler(0,0,0,"YXZ");return function(t){return i.set(r.rotation.x,a.rotation.y,0),t.copy(e).applyEuler(i),t}}(),this.update=function(){if(!1!==s.enabled){var e=performance.now(),t=(e-u)/1e3;p.x-=10*p.x*t,p.z-=10*p.z*t,p.y-=9.8*100*t,n&&(p.z-=400*t),o&&(p.z+=400*t),c&&(p.x-=400*t),h&&(p.x+=400*t),!0===l&&(p.y=Math.max(0,p.y)),a.translateX(p.x*t),a.translateY(p.y*t),a.translateZ(p.z*t),a.position.y<10&&(p.y=0,a.position.y=10,d=!0),u=e}}}},"88e7":function(e,t,i){"use strict";var s=i("109d"),r=i.n(s);r.a},ad78:function(e,t,i){e.exports=i.p+"img/lock.ae7ad660.svg"},c2b0:function(e,t,i){e.exports=i.p+"img/lock.9fe83a15.png"},de11:function(e,t,i){var s=i("5a89"),r=function(){var e,t,i,r,a,n,o,c,h,l=null,d=null,u=null,p={},m={},f={},g={},v={},b={},y={},k={},w={},x=s.SmoothShading,N={centerGeometry:!1,convertUpAxis:!1,subdivideFaces:!0,upAxis:"Y",defaultEnvMap:null},C=1,_="Y",M=null;function T(e,t,i,s){var r=0;if(document.implementation&&document.implementation.createDocument){var a=new XMLHttpRequest;a.onreadystatechange=function(){4===a.readyState?0!==a.status&&200!==a.status||(a.response?(u=t,j(a.response,void 0,e)):s?s():console.error("ColladaLoader: Empty or non-existing file ("+e+")")):3===a.readyState&&i&&(0===r&&(r=a.getResponseHeader("Content-Length")),i({total:r,loaded:a.responseText.length}))},a.open("GET",e,!0),a.send(null)}else alert("Don't know how to parse XML!")}function j(p,x,N){if(l=(new DOMParser).parseFromString(p,"text/xml"),x=x||u,void 0!==N){var _=N.split("/");_.pop(),o=(_.length<1?".":_.join("/"))+"/"}O(),He(),m=S("library_images image",Q,"image"),b=S("library_materials material",ye,"material"),y=S("library_effects effect",Ce,"effect"),v=S("library_geometries geometry",he,"geometry"),k=S("library_cameras camera",Oe,"camera"),w=S("library_lights light",Ee,"light"),g=S("library_controllers controller",ee,"controller"),f=S("library_animations animation",Me,"animation"),a=S("library_visual_scenes visual_scene",se,"visual_scene"),n=S("library_kinematics_models kinematics_model",Ie,"kinematics_model"),c=[],h=[],e=E(),d=new s.Group;for(var M=0;M<e.nodes.length;M++)d.add(B(e.nodes[M]));d.scale.multiplyScalar(C),I(),t=L(),D();var T={scene:d,morphs:c,skins:h,animations:i,kinematics:r,dae:{images:m,materials:b,cameras:k,lights:w,effects:y,geometries:v,controllers:g,animations:f,visualScenes:a,visualScene:e,scene:e,kinematicsModels:n,kinematicsModel:t}};return x&&x(T),T}function A(e){x=e}function O(){var e=l.querySelectorAll("asset"),t=e[0];if(t&&t.childNodes)for(var i=0;i<t.childNodes.length;i++){var s=t.childNodes[i];switch(s.nodeName){case"unit":var r=s.getAttribute("meter");r&&(C=parseFloat(r));break;case"up_axis":_=s.textContent.charAt(0);break}}}function S(e,t,i){for(var s=l.querySelectorAll(e),r={},a=0,n=s.length,o=0;o<n;o++){var c=s[o],h=(new t).parse(c);h.id&&0!==h.id.length||(h.id=i+a++),r[h.id]=h}return r}function E(){var e=l.querySelectorAll("scene instance_visual_scene")[0];if(e){var t=e.getAttribute("url").replace(/^#/,"");return a[t.length>0?t:"visual_scene0"]}return null}function L(){var e=l.querySelectorAll("instance_kinematics_model")[0];if(e){var t=e.getAttribute("url").replace(/^#/,"");return n[t.length>0?t:"kinematics_model0"]}return null}function I(){i=[],q(d)}function q(t){var s=e.getChildById(t.colladaId,!0),r=null;if(s&&s.keys){r={fps:60,hierarchy:[{node:s,keys:s.keys,sids:s.sids}],node:t,name:"animation_"+t.name,length:0},i.push(r);for(var a=0,n=s.keys.length;a<n;a++)r.length=Math.max(r.length,s.keys[a].time)}else r={hierarchy:[{keys:[],sids:[]}]};for(a=0,n=t.children.length;a<n;a++)for(var o=q(t.children[a]),c=0,h=o.hierarchy.length;c<h;c++)r.hierarchy.push({keys:[],sids:[]});return r}function z(){var e,t=1e6,i=-t,s=0;for(var r in f){var a=f[r];e=e||a.id;for(var n=0;n<a.sampler.length;n++){var o=a.sampler[n];o.create(),t=Math.min(t,o.startTime),i=Math.max(i,o.endTime),s=Math.max(s,o.input.length)}}return{start:t,end:i,frames:s,ID:e}}function P(e,t){var i=t instanceof ne?g[t.url]:t;if(i&&i.morph){for(var s=i.morph,r=0;r<s.targets.length;r++){var a=s.targets[r],n=v[a];if(n.mesh&&n.mesh.primitives&&n.mesh.primitives.length){var o=n.mesh.primitives[0].geometry;o.vertices.length===e.vertices.length&&e.morphTargets.push({name:"target_1",vertices:o.vertices})}}e.morphTargets.push({name:"target_Z",vertices:e.vertices})}else console.log("could not find morph controller!")}function R(e,t,i,r){if(e.world=e.world||new s.Matrix4,e.localworld=e.localworld||new s.Matrix4,e.world.copy(e.matrix),e.localworld.copy(e.matrix),e.channels&&e.channels.length){var a=e.channels[0],n=a.sampler.output[i];n instanceof s.Matrix4&&(e.world.copy(n),e.localworld.copy(n),0===i&&e.matrix.copy(n))}r&&e.world.multiplyMatrices(r,e.world),t.push(e);for(var o=0;o<e.nodes.length;o++)R(e.nodes[o],t,i,e.world)}function V(e,t){for(var i=0;i<e.length;i++){var r=e[i],a=-1;if("JOINT"==r.type){for(var n=0;n<t.joints.length;n++)if(r.sid===t.joints[n]){a=n;break}if(a>=0){var o=t.invBindMatrices[a];r.invBindMatrix=o,r.skinningMatrix=new s.Matrix4,r.skinningMatrix.multiplyMatrices(r.world,o),r.animatrix=new s.Matrix4,r.animatrix.copy(r.localworld),r.weights=[];for(n=0;n<t.weights.length;n++)for(var c=0;c<t.weights[n].length;c++){var h=t.weights[n][c];h.joint===a&&r.weights.push(h)}}else console.warn("ColladaLoader: Could not find joint '"+r.sid+"'."),r.skinningMatrix=new s.Matrix4,r.weights=[]}}}function Y(e){var t=[],i=function(e,t,r){var a={};a.name=t.sid,a.parent=e,a.matrix=t.matrix;var n=[new s.Vector3,new s.Quaternion,new s.Vector3];for(var o in a.matrix.decompose(n[0],n[1],n[2]),a.pos=[n[0].x,n[0].y,n[0].z],a.scl=[n[2].x,n[2].y,n[2].z],a.rotq=[n[1].x,n[1].y,n[1].z,n[1].w],r.push(a),t.nodes)i(t.sid,t.nodes[o],r)};return i(-1,e,t),t}function F(e,t,i){var r=[];R(t,r,-1),V(r,i.skin);for(var a=new s.Vector3,n=[],o=0;o<e.vertices.length;o++)n.push(new s.Vector3);for(o=0;o<r.length;o++)if("JOINT"==r[o].type)for(var c=0;c<r[o].weights.length;c++){var h=r[o].weights[c],l=h.index,d=h.weight,u=e.vertices[l],p=n[l];a.x=u.x,a.y=u.y,a.z=u.z,a.applyMatrix4(r[o].skinningMatrix),p.x+=a.x*d,p.y+=a.y*d,p.z+=a.z*d}for(o=0;o<e.vertices.length;o++)e.vertices[o]=n[o]}function X(t,i,r){var a=g[i.url];if(r=void 0!==r?r:40,a&&a.skin)if(i.skeleton&&i.skeleton.length){for(var n=z(),o=e.getChildById(i.skeleton[0],!0)||e.getChildBySid(i.skeleton[0],!0),c=Y(o),h=a.skin.joints,l=[],d=0;d<h.length;d++)for(var u=0;u<c.length;u++)c[u].name===h[d]&&(l[d]=c[u]);for(var d=0;d<l.length;d++)for(var u=0;u<l.length;u++)l[d].parent===l[u].name&&(l[d].parent=u);new s.Vector3;for(d=0;d<t.vertices.length;d++)t.vertices[d].applyMatrix4(a.skin.bindShapeMatrix);var p=[],m=[],f=a.skin.weights;for(d=0;d<f.length;d++){var v=new s.Vector4(f[d][0]?f[d][0].joint:0,f[d][1]?f[d][1].joint:0,f[d][2]?f[d][2].joint:0,f[d][3]?f[d][3].joint:0),b=new s.Vector4(f[d][0]?f[d][0].weight:0,f[d][1]?f[d][1].weight:0,f[d][2]?f[d][2].weight:0,f[d][3]?f[d][3].weight:0);p.push(v),m.push(b)}t.skinIndices=p,t.skinWeights=m,t.bones=l;var y={name:n.ID,fps:30,length:n.frames/30,hierarchy:[]};for(u=0;u<l.length;u++)y.hierarchy.push({parent:l[u].parent,name:l[u].name,keys:[]});for(console.log("ColladaLoader:",n.ID+" has "+l.length+" bones."),F(t,o,a),r=0;r<n.frames;r++){var k=[];R(o,k,r),V(k,a.skin);for(d=0;d<k.length;d++)for(u=0;u<y.hierarchy.length;u++)if(y.hierarchy[u].name===k[d].sid){var w={};w.time=r/30,w.matrix=k[d].animatrix,0===r&&(k[d].matrix=w.matrix);var x=[new s.Vector3,new s.Quaternion,new s.Vector3];w.matrix.decompose(x[0],x[1],x[2]),w.pos=[x[0].x,x[0].y,x[0].z],w.scl=[x[2].x,x[2].y,x[2].z],w.rot=x[1],y.hierarchy[u].keys.push(w)}t.animation=y}}else console.log("ColladaLoader: Could not find the skeleton for the skin. ");else console.log("ColladaLoader: Could not find skin controller.")}function D(){if(t&&0===t.joints.length)r=void 0;else{var i={},a=function(s,r){var a=r.getAttribute("id"),n=e.getChildById(a,!0),o=t.joints[s];d.traverse((function(e){e.colladaId==a&&(i[s]={node:e,transforms:n.transforms,joint:o,position:o.zeroPosition})}))};r={joints:t&&t.joints,getJointValue:function(e){var t=i[e];if(t)return t.position;console.log("getJointValue: joint "+e+" doesn't exist")},setJointValue:function(e,t){var r=i[e];if(r){var a=r.joint;if(t>a.limits.max||t<a.limits.min)console.log("setJointValue: joint "+e+" value "+t+" outside of limits (min: "+a.limits.min+", max: "+a.limits.max+")");else if(a.static)console.log("setJointValue: joint "+e+" is static");else{var n=r.node,c=a.axis,h=r.transforms,l=new s.Matrix4;for(o=0;o<h.length;o++){var d=h[o];if(d.sid&&-1!==d.sid.indexOf("joint"+e))switch(a.type){case"revolute":l.multiply(u.makeRotationAxis(c,s.Math.degToRad(t)));break;case"prismatic":l.multiply(u.makeTranslation(c.x*t,c.y*t,c.z*t));break;default:console.warn("setJointValue: unknown joint type: "+a.type);break}else{var u=new s.Matrix4;switch(d.type){case"matrix":l.multiply(d.obj);break;case"translate":l.multiply(u.makeTranslation(d.obj.x,d.obj.y,d.obj.z));break;case"rotate":l.multiply(u.makeRotationAxis(d.obj,d.angle));break}}}var p=l.elements,m=Array.prototype.slice.call(p),f=[m[0],m[4],m[8],m[12],m[1],m[5],m[9],m[13],m[2],m[6],m[10],m[14],m[3],m[7],m[11],m[15]];n.matrix.set.apply(n.matrix,f),n.matrix.decompose(n.position,n.quaternion,n.scale)}}else console.log("setJointValue: joint "+e+" doesn't exist")}};var n=l.querySelector("scene instance_kinematics_scene");if(n)for(var o=0;o<n.childNodes.length;o++){var c=n.childNodes[o];if(1==c.nodeType)switch(c.nodeName){case"bind_joint_axis":var h=c.getAttribute("target").split("/").pop(),u=c.querySelector("axis param").textContent,p=parseInt(u.split("joint").pop().split(".")[0]),m=l.querySelector('[sid="'+h+'"]');if(m){var f=m.parentElement;a(p,f)}break;default:break}}}}function B(e,t){var i,r,a,n,o=new s.Object3D;for(a=0;a<e.controllers.length;a++){var l=g[e.controllers[a].url];switch(l.type){case"skin":if(v[l.skin.source]){var d=new ce;d.url=l.skin.source,d.instance_material=e.controllers[a].instance_material,e.geometries.push(d),!0,i=e.controllers[a]}else if(g[l.skin.source]){var u=g[l.skin.source];if(r=u,u.morph&&v[u.morph.source]){d=new ce;d.url=u.morph.source,d.instance_material=e.controllers[a].instance_material,e.geometries.push(d)}}break;case"morph":if(v[l.morph.source]){d=new ce;d.url=l.morph.source,d.instance_material=e.controllers[a].instance_material,e.geometries.push(d),r=e.controllers[a]}console.log("ColladaLoader: Morph-controller partially supported.");default:break}}var p={};for(a=0;a<e.geometries.length;a++){var m,f=e.geometries[a],x=f.instance_material,C=v[f.url],_={},M=[],T=0;if(C){if(!C.mesh||!C.mesh.primitives)continue;if(0===o.name.length&&(o.name=C.id),x)for(n=0;n<x.length;n++){var j=x[n],A=b[j.target],O=A.instance_effect.url,S=y[O].shader,E=S.material;if(C.doubleSided){if(!(j.symbol in p)){var L=E.clone();L.side=s.DoubleSide,p[j.symbol]=L}E=p[j.symbol]}E.opacity=E.opacity?E.opacity:1,_[j.symbol]=T,M.push(E),m=E,m.name=null===A.name||""===A.name?A.id:A.name,T++}var I,q=m||new s.MeshLambertMaterial({color:14540253,side:C.doubleSided?s.DoubleSide:s.FrontSide}),z=C.mesh.geometry3js;T>1&&(q=new s.MultiMaterial(M)),void 0!==i?(X(z,i),z.morphTargets.length>0?(q.morphTargets=!0,q.skinning=!1):(q.morphTargets=!1,q.skinning=!0),I=new s.SkinnedMesh(z,q,!1),I.name="skin_"+h.length,h.push(I)):void 0!==r?(P(z,r),q.morphTargets=!0,I=new s.Mesh(z,q),I.name="morph_"+c.length,c.push(I)):I=!0===z.isLineStrip?new s.Line(z):new s.Mesh(z,q),o.add(I)}}for(a=0;a<e.cameras.length;a++){var R=e.cameras[a],V=k[R.url],Y=new s.PerspectiveCamera(V.yfov,parseFloat(V.aspect_ratio),parseFloat(V.znear),parseFloat(V.zfar));o.add(Y)}for(a=0;a<e.lights.length;a++){var F=null,D=e.lights[a],Z=w[D.url];if(Z&&Z.technique){var U=Z.color.getHex(),H=Z.intensity,G=Z.distance,J=Z.falloff_angle;switch(Z.technique){case"directional":F=new s.DirectionalLight(U,H,G),F.position.set(0,0,1);break;case"point":F=new s.PointLight(U,H,G);break;case"spot":F=new s.SpotLight(U,H,G,J),F.position.set(0,0,1);break;case"ambient":F=new s.AmbientLight(U);break}}F&&o.add(F)}if(o.name=e.name||e.id||"",o.colladaId=e.id||"",o.layer=e.layer||"",o.matrix=e.matrix,o.matrix.decompose(o.position,o.quaternion,o.scale),N.centerGeometry&&o.geometry){var W=o.geometry.center();W.multiply(o.scale),W.applyQuaternion(o.quaternion),o.position.sub(W)}for(a=0;a<e.nodes.length;a++)o.add(B(e.nodes[a],e));return o}function Z(e){for(var t=l.querySelectorAll("library_nodes node"),i=0;i<t.length;i++){var s=t[i].attributes.getNamedItem("id");if(s&&s.value===e)return t[i]}}function U(e){var t=[],i=1e6,s=-1e6;for(var r in f)for(var a=f[r],n=0;n<a.channel.length;n++){var o=a.channel[n],c=a.sampler[n];r=o.target.split("/")[0];r==e.id&&(c.create(),o.sampler=c,i=Math.min(i,c.startTime),s=Math.max(s,c.endTime),t.push(o))}return t.length&&(e.startTime=i,e.endTime=s),t}function H(e){if(e.channels&&e.channels.length){for(var t=[],i=[],s=0,r=e.channels.length;s<r;s++){var a,n=e.channels[s],o=n.fullSid,c=n.sampler,h=c.input,l=e.getTransformBySid(n.sid);if(n.arrIndices){a=[];for(var d=0,u=n.arrIndices.length;d<u;d++)a[d]=Ke(n.arrIndices[d])}else a=Qe(n.member);if(l){-1===i.indexOf(o)&&i.push(o);for(d=0,u=h.length;d<u;d++){var p=h[d],m=c.getData(l.type,d,a),f=G(t,p);if(!f){f=new Ae(p);var g=J(t,p);t.splice(-1===g?t.length:g,0,f)}f.addTarget(o,l,a,m)}}else console.log('Could not find transform "'+n.sid+'" in node '+e.id)}for(s=0;s<i.length;s++){var v=i[s];for(d=0;d<t.length;d++){f=t[d];f.hasTarget(v)||W(t,f,d,v)}}e.keys=t,e.sids=i}}function G(e,t){for(var i=null,s=0,r=e.length;s<r&&null===i;s++){var a=e[s];if(a.time===t)i=a;else if(a.time>t)break}return i}function J(e,t){for(var i=-1,s=0,r=e.length;s<r&&-1===i;s++){var a=e[s];a.time>=t&&(i=s)}return i}function W(e,t,i,s){var r=K(e,s,i?i-1:0),a=$(e,s,i+1);if(r&&a){var n,o=(t.time-r.time)/(a.time-r.time),c=r.getTarget(s),h=a.getTarget(s).data,l=c.data;if("matrix"===c.type)n=l;else if(l.length){n=[];for(var d=0;d<l.length;++d)n[d]=l[d]+(h[d]-l[d])*o}else n=l+(h-l)*o;t.addTarget(s,c.transform,c.member,n)}}function $(e,t,i){for(;i<e.length;i++){var s=e[i];if(s.hasTarget(t))return s}return null}function K(e,t,i){for(i=i>=0?i:i+e.length;i>=0;i--){var s=e[i];if(s.hasTarget(t))return s}return null}function Q(){this.id="",this.init_from=""}function ee(){this.id="",this.name="",this.type="",this.skin=null,this.morph=null}function te(){this.method=null,this.source=null,this.targets=null,this.weights=null}function ie(){this.source="",this.bindShapeMatrix=null,this.invBindMatrices=[],this.joints=[],this.weights=[]}function se(){this.id="",this.name="",this.nodes=[],this.scene=new s.Group}function re(){this.id="",this.name="",this.sid="",this.nodes=[],this.controllers=[],this.transforms=[],this.geometries=[],this.channels=[],this.matrix=new s.Matrix4}function ae(){this.sid="",this.type="",this.data=[],this.obj=null}function ne(){this.url="",this.skeleton=[],this.instance_material=[]}function oe(){this.symbol="",this.target=""}function ce(){this.url="",this.instance_material=[]}function he(){this.id="",this.mesh=null}function le(e){this.geometry=e.id,this.primitives=[],this.vertices=null,this.geometry3js=null}function de(){this.material="",this.count=0,this.inputs=[],this.vcount=null,this.p=[],this.geometry=new s.Geometry}function ue(){de.call(this),this.vcount=[]}function pe(){de.call(this),this.vcount=1}function me(){de.call(this),this.vcount=3}function fe(){this.source="",this.count=0,this.stride=0,this.params=[]}function ge(){this.input={}}function ve(){this.semantic="",this.offset=0,this.source="",this.set=0}function be(e){this.id=e,this.type=null}function ye(){this.id="",this.name="",this.instance_effect=null}function ke(){this.color=new s.Color,this.color.setRGB(Math.random(),Math.random(),Math.random()),this.color.a=1,this.texture=null,this.texcoord=null,this.texOpts=null}function we(e,t){this.type=e,this.effect=t,this.material=null}function xe(e){this.effect=e,this.init_from=null,this.format=null}function Ne(e){this.effect=e,this.source=null,this.wrap_s=null,this.wrap_t=null,this.minfilter=null,this.magfilter=null,this.mipfilter=null}function Ce(){this.id="",this.name="",this.shader=null,this.surface={},this.sampler={}}function _e(){this.url=""}function Me(){this.id="",this.name="",this.source={},this.sampler=[],this.channel=[]}function Te(e){this.animation=e,this.source="",this.target="",this.fullSid=null,this.sid=null,this.dotSyntax=null,this.arrSyntax=null,this.arrIndices=null,this.member=null}function je(e){this.id="",this.animation=e,this.inputs=[],this.input=null,this.output=null,this.strideOut=null,this.interpolation=null,this.startTime=null,this.endTime=null,this.duration=0}function Ae(e){this.targets=[],this.time=e}function Oe(){this.id="",this.name="",this.technique=""}function Se(){this.url=""}function Ee(){this.id="",this.name="",this.technique=""}function Le(){this.url=""}function Ie(){this.id="",this.name="",this.joints=[],this.links=[]}function qe(){this.sid="",this.name="",this.axis=new s.Vector3,this.limits={min:0,max:0},this.type="",this.static=!1,this.zeroPosition=0,this.middlePosition=0}function ze(){this.sid="",this.name="",this.transforms=[],this.attachments=[]}function Pe(){this.joint="",this.transforms=[],this.links=[]}function Re(e){var t=e.getAttribute("id");return void 0!=p[t]||(p[t]=new be(t).parse(e)),p[t]}function Ve(e){for(var t=Xe(e),i=[],s=0,r=t.length;s<r;s++)i.push("true"===t[s]||"1"===t[s]);return i}function Ye(e){for(var t=Xe(e),i=[],s=0,r=t.length;s<r;s++)i.push(parseFloat(t[s]));return i}function Fe(e){for(var t=Xe(e),i=[],s=0,r=t.length;s<r;s++)i.push(parseInt(t[s],10));return i}function Xe(e){return e.length>0?De(e).split(/\s+/):[]}function De(e){return e.replace(/^\s+/,"").replace(/\s+$/,"")}function Be(e,t,i){return e.hasAttribute(t)?parseInt(e.getAttribute(t),10):i}function Ze(e,t){var i=new s.ImageLoader;i.load(t,(function(t){e.image=t,e.needsUpdate=!0}))}function Ue(e,t){e.doubleSided=!1;var i=t.querySelectorAll("extra double_sided")[0];i&&i&&1===parseInt(i.textContent,10)&&(e.doubleSided=!0)}function He(){if(!0!==N.convertUpAxis||_===N.upAxis)M=null;else switch(_){case"X":M="Y"===N.upAxis?"XtoY":"XtoZ";break;case"Y":M="X"===N.upAxis?"YtoX":"YtoZ";break;case"Z":M="X"===N.upAxis?"ZtoX":"ZtoY";break}}function Ge(e,t){if(!0===N.convertUpAxis&&_!==N.upAxis)switch(M){case"XtoY":var i=e[0];e[0]=t*e[1],e[1]=i;break;case"XtoZ":i=e[2];e[2]=e[1],e[1]=e[0],e[0]=i;break;case"YtoX":i=e[0];e[0]=e[1],e[1]=t*i;break;case"YtoZ":i=e[1];e[1]=t*e[2],e[2]=i;break;case"ZtoX":i=e[0];e[0]=e[1],e[1]=e[2],e[2]=i;break;case"ZtoY":i=e[1];e[1]=e[2],e[2]=t*i;break}}function Je(e,t){if(!0!==N.convertUpAxis||_===N.upAxis)return t;switch(e){case"X":t="XtoY"===M?-1*t:t;break;case"Y":t="YtoZ"===M||"YtoX"===M?-1*t:t;break;case"Z":t="ZtoY"===M?-1*t:t;break;default:break}return t}function We(e,t){var i=[e[t],e[t+1],e[t+2]];return Ge(i,-1),new s.Vector3(i[0],i[1],i[2])}function $e(e){if(N.convertUpAxis){var t=[e[0],e[4],e[8]];Ge(t,-1),e[0]=t[0],e[4]=t[1],e[8]=t[2],t=[e[1],e[5],e[9]],Ge(t,-1),e[1]=t[0],e[5]=t[1],e[9]=t[2],t=[e[2],e[6],e[10]],Ge(t,-1),e[2]=t[0],e[6]=t[1],e[10]=t[2],t=[e[0],e[1],e[2]],Ge(t,-1),e[0]=t[0],e[1]=t[1],e[2]=t[2],t=[e[4],e[5],e[6]],Ge(t,-1),e[4]=t[0],e[5]=t[1],e[6]=t[2],t=[e[8],e[9],e[10]],Ge(t,-1),e[8]=t[0],e[9]=t[1],e[10]=t[2],t=[e[3],e[7],e[11]],Ge(t,-1),e[3]=t[0],e[7]=t[1],e[11]=t[2]}return(new s.Matrix4).set(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}function Ke(e){if(e>-1&&e<3){var t=["X","Y","Z"],i={X:0,Y:1,Z:2};e=Qe(t[e]),e=i[e]}return e}function Qe(e){if(N.convertUpAxis)switch(e){case"X":switch(M){case"XtoY":case"XtoZ":case"YtoX":e="Y";break;case"ZtoX":e="Z";break}break;case"Y":switch(M){case"XtoY":case"YtoX":case"ZtoX":e="X";break;case"XtoZ":case"YtoZ":case"ZtoY":e="Z";break}break;case"Z":switch(M){case"XtoZ":e="X";break;case"YtoZ":case"ZtoX":case"ZtoY":e="Y";break}break}return e}return Q.prototype.parse=function(e){this.id=e.getAttribute("id");for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];"init_from"===i.nodeName&&(this.init_from=i.textContent)}return this},ee.prototype.parse=function(e){this.id=e.getAttribute("id"),this.name=e.getAttribute("name"),this.type="none";for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];switch(i.nodeName){case"skin":this.skin=(new ie).parse(i),this.type=i.nodeName;break;case"morph":this.morph=(new te).parse(i),this.type=i.nodeName;break;default:break}}return this},te.prototype.parse=function(e){var t,i={},s=[];for(this.method=e.getAttribute("method"),this.source=e.getAttribute("source").replace(/^#/,""),t=0;t<e.childNodes.length;t++){var r=e.childNodes[t];if(1==r.nodeType)switch(r.nodeName){case"source":var a=(new be).parse(r);i[a.id]=a;break;case"targets":s=this.parseInputs(r);break;default:console.log(r.nodeName);break}}for(t=0;t<s.length;t++){var n=s[t];a=i[n.source];switch(n.semantic){case"MORPH_TARGET":this.targets=a.read();break;case"MORPH_WEIGHT":this.weights=a.read();break;default:break}}return this},te.prototype.parseInputs=function(e){for(var t=[],i=0;i<e.childNodes.length;i++){var s=e.childNodes[i];if(1==s.nodeType)switch(s.nodeName){case"input":t.push((new ve).parse(s));break;default:break}}return t},ie.prototype.parse=function(e){var t,i,s={};this.source=e.getAttribute("source").replace(/^#/,""),this.invBindMatrices=[],this.joints=[],this.weights=[];for(var r=0;r<e.childNodes.length;r++){var a=e.childNodes[r];if(1==a.nodeType)switch(a.nodeName){case"bind_shape_matrix":var n=Ye(a.textContent);this.bindShapeMatrix=$e(n);break;case"source":var o=(new be).parse(a);s[o.id]=o;break;case"joints":t=a;break;case"vertex_weights":i=a;break;default:console.log(a.nodeName);break}}return this.parseJoints(t,s),this.parseWeights(i,s),this},ie.prototype.parseJoints=function(e,t){for(var i=0;i<e.childNodes.length;i++){var s=e.childNodes[i];if(1==s.nodeType)switch(s.nodeName){case"input":var r=(new ve).parse(s),a=t[r.source];"JOINT"===r.semantic?this.joints=a.read():"INV_BIND_MATRIX"===r.semantic&&(this.invBindMatrices=a.read());break;default:break}}},ie.prototype.parseWeights=function(e,t){for(var i,s,r=[],a=0;a<e.childNodes.length;a++){var n=e.childNodes[a];if(1==n.nodeType)switch(n.nodeName){case"input":r.push((new ve).parse(n));break;case"v":i=Fe(n.textContent);break;case"vcount":s=Fe(n.textContent);break;default:break}}var o=0;for(a=0;a<s.length;a++){for(var c=s[a],h=[],l=0;l<c;l++){for(var d={},u=0;u<r.length;u++){var p=r[u],m=i[o+p.offset];switch(p.semantic){case"JOINT":d.joint=m;break;case"WEIGHT":d.weight=t[p.source].data[m];break;default:break}}h.push(d),o+=r.length}for(l=0;l<h.length;l++)h[l].index=a;this.weights.push(h)}},se.prototype.getChildById=function(e,t){for(var i=0;i<this.nodes.length;i++){var s=this.nodes[i].getChildById(e,t);if(s)return s}return null},se.prototype.getChildBySid=function(e,t){for(var i=0;i<this.nodes.length;i++){var s=this.nodes[i].getChildBySid(e,t);if(s)return s}return null},se.prototype.parse=function(e){this.id=e.getAttribute("id"),this.name=e.getAttribute("name"),this.nodes=[];for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"node":this.nodes.push((new re).parse(i));break;default:break}}return this},re.prototype.getChannelForTransform=function(e){for(var t=0;t<this.channels.length;t++){var i,s=this.channels[t],r=s.target.split("/"),a=(r.shift(),r.shift()),n=a.indexOf(".")>=0,o=a.indexOf("(")>=0;if(n)r=a.split("."),a=r.shift(),r.shift();else if(o){i=a.split("("),a=i.shift();for(var c=0;c<i.length;c++)i[c]=parseInt(i[c].replace(/\)/,""))}if(a===e)return s.info={sid:a,dotSyntax:n,arrSyntax:o,arrIndices:i},s}return null},re.prototype.getChildById=function(e,t){if(this.id===e)return this;if(t)for(var i=0;i<this.nodes.length;i++){var s=this.nodes[i].getChildById(e,t);if(s)return s}return null},re.prototype.getChildBySid=function(e,t){if(this.sid===e)return this;if(t)for(var i=0;i<this.nodes.length;i++){var s=this.nodes[i].getChildBySid(e,t);if(s)return s}return null},re.prototype.getTransformBySid=function(e){for(var t=0;t<this.transforms.length;t++)if(this.transforms[t].sid===e)return this.transforms[t];return null},re.prototype.parse=function(e){var t;this.id=e.getAttribute("id"),this.sid=e.getAttribute("sid"),this.name=e.getAttribute("name"),this.type=e.getAttribute("type"),this.layer=e.getAttribute("layer"),this.type="JOINT"===this.type?this.type:"NODE",this.nodes=[],this.transforms=[],this.geometries=[],this.cameras=[],this.lights=[],this.controllers=[],this.matrix=new s.Matrix4;for(var i=0;i<e.childNodes.length;i++){var r=e.childNodes[i];if(1==r.nodeType)switch(r.nodeName){case"node":this.nodes.push((new re).parse(r));break;case"instance_camera":this.cameras.push((new Se).parse(r));break;case"instance_controller":this.controllers.push((new ne).parse(r));break;case"instance_geometry":this.geometries.push((new ce).parse(r));break;case"instance_light":this.lights.push((new Le).parse(r));break;case"instance_node":t=r.getAttribute("url").replace(/^#/,"");var a=Z(t);a&&this.nodes.push((new re).parse(a));break;case"rotate":case"translate":case"scale":case"matrix":case"lookat":case"skew":this.transforms.push((new ae).parse(r));break;case"extra":break;default:console.log(r.nodeName);break}}return this.channels=U(this),H(this),this.updateMatrix(),this},re.prototype.updateMatrix=function(){this.matrix.identity();for(var e=0;e<this.transforms.length;e++)this.transforms[e].apply(this.matrix)},ae.prototype.parse=function(e){return this.sid=e.getAttribute("sid"),this.type=e.nodeName,this.data=Ye(e.textContent),this.convert(),this},ae.prototype.convert=function(){switch(this.type){case"matrix":this.obj=$e(this.data);break;case"rotate":this.angle=s.Math.degToRad(this.data[3]);case"translate":Ge(this.data,-1),this.obj=new s.Vector3(this.data[0],this.data[1],this.data[2]);break;case"scale":Ge(this.data,1),this.obj=new s.Vector3(this.data[0],this.data[1],this.data[2]);break;default:console.log("Can not convert Transform of type "+this.type);break}},ae.prototype.apply=function(){var e=new s.Matrix4;return function(t){switch(this.type){case"matrix":t.multiply(this.obj);break;case"translate":t.multiply(e.makeTranslation(this.obj.x,this.obj.y,this.obj.z));break;case"rotate":t.multiply(e.makeRotationAxis(this.obj,this.angle));break;case"scale":t.scale(this.obj);break}}}(),ae.prototype.update=function(e,t){var i=["X","Y","Z","ANGLE"];switch(this.type){case"matrix":if(t)if(1===t.length)switch(t[0]){case 0:this.obj.n11=e[0],this.obj.n21=e[1],this.obj.n31=e[2],this.obj.n41=e[3];break;case 1:this.obj.n12=e[0],this.obj.n22=e[1],this.obj.n32=e[2],this.obj.n42=e[3];break;case 2:this.obj.n13=e[0],this.obj.n23=e[1],this.obj.n33=e[2],this.obj.n43=e[3];break;case 3:this.obj.n14=e[0],this.obj.n24=e[1],this.obj.n34=e[2],this.obj.n44=e[3];break}else if(2===t.length){var r="n"+(t[0]+1)+(t[1]+1);this.obj[r]=e}else console.log("Incorrect addressing of matrix in transform.");else this.obj.copy(e);break;case"translate":case"scale":switch("[object Array]"===Object.prototype.toString.call(t)&&(t=i[t[0]]),t){case"X":this.obj.x=e;break;case"Y":this.obj.y=e;break;case"Z":this.obj.z=e;break;default:this.obj.x=e[0],this.obj.y=e[1],this.obj.z=e[2];break}break;case"rotate":switch("[object Array]"===Object.prototype.toString.call(t)&&(t=i[t[0]]),t){case"X":this.obj.x=e;break;case"Y":this.obj.y=e;break;case"Z":this.obj.z=e;break;case"ANGLE":this.angle=s.Math.degToRad(e);break;default:this.obj.x=e[0],this.obj.y=e[1],this.obj.z=e[2],this.angle=s.Math.degToRad(e[3]);break}break}},ne.prototype.parse=function(e){this.url=e.getAttribute("url").replace(/^#/,""),this.skeleton=[],this.instance_material=[];for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1===i.nodeType)switch(i.nodeName){case"skeleton":this.skeleton.push(i.textContent.replace(/^#/,""));break;case"bind_material":for(var s=i.querySelectorAll("instance_material"),r=0;r<s.length;r++){var a=s[r];this.instance_material.push((new oe).parse(a))}break;case"extra":break;default:break}}return this},oe.prototype.parse=function(e){return this.symbol=e.getAttribute("symbol"),this.target=e.getAttribute("target").replace(/^#/,""),this},ce.prototype.parse=function(e){this.url=e.getAttribute("url").replace(/^#/,""),this.instance_material=[];for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType&&"bind_material"===i.nodeName){for(var s=i.querySelectorAll("instance_material"),r=0;r<s.length;r++){var a=s[r];this.instance_material.push((new oe).parse(a))}break}}return this},he.prototype.parse=function(e){this.id=e.getAttribute("id"),Ue(this,e);for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];switch(i.nodeName){case"mesh":this.mesh=new le(this).parse(i);break;case"extra":break;default:break}}return this},le.prototype.parse=function(e){this.primitives=[];for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];switch(i.nodeName){case"source":Re(i);break;case"vertices":this.vertices=(new ge).parse(i);break;case"linestrips":this.primitives.push((new pe).parse(i));break;case"triangles":this.primitives.push((new me).parse(i));break;case"polygons":this.primitives.push((new de).parse(i));break;case"polylist":this.primitives.push((new ue).parse(i));break;default:break}}if(this.geometry3js=new s.Geometry,null===this.vertices)return this;var r=p[this.vertices.input["POSITION"].source].data;for(t=0;t<r.length;t+=3)this.geometry3js.vertices.push(We(r,t).clone());for(t=0;t<this.primitives.length;t++){var a=this.primitives[t];a.setVertices(this.vertices),this.handlePrimitive(a,this.geometry3js)}return this.geometry3js.calcNormals&&(this.geometry3js.computeVertexNormals(),delete this.geometry3js.calcNormals),this},le.prototype.handlePrimitive=function(e,t){if(e instanceof pe)t.isLineStrip=!0;else{var i,r,a,n,o,c,h,l=e.p,d=e.inputs,u=0,m=3,f=0,g=[];for(i=0;i<d.length;i++){a=d[i];var v=a.offset+1;switch(f=f<v?v:f,a.semantic){case"TEXCOORD":g.push(a.set);break}}for(var b=0;b<l.length;++b){var y=l[b],k=0;while(k<y.length){var w=[],x=[],C=null,_=[];for(m=e.vcount?e.vcount.length?e.vcount[u++]:e.vcount:y.length/f,i=0;i<m;i++)for(r=0;r<d.length;r++)switch(a=d[r],c=p[a.source],n=y[k+i*f+a.offset],h=c.accessor.params.length,o=n*h,a.semantic){case"VERTEX":w.push(n);break;case"NORMAL":x.push(We(c.data,o));break;case"TEXCOORD":C=C||{},void 0===C[a.set]&&(C[a.set]=[]),C[a.set].push(new s.Vector2(c.data[o],c.data[o+1]));break;case"COLOR":_.push((new s.Color).setRGB(c.data[o],c.data[o+1],c.data[o+2]));break;default:break}if(0===x.length)if(a=this.vertices.input.NORMAL,a){c=p[a.source],h=c.accessor.params.length;for(var M=0,T=w.length;M<T;M++)x.push(We(c.data,w[M]*h))}else t.calcNormals=!0;if(!C&&(C={},a=this.vertices.input.TEXCOORD,a)){g.push(a.set),c=p[a.source],h=c.accessor.params.length;for(M=0,T=w.length;M<T;M++)o=w[M]*h,void 0===C[a.set]&&(C[a.set]=[]),C[a.set].push(new s.Vector2(c.data[o],1-c.data[o+1]))}if(0===_.length&&(a=this.vertices.input.COLOR,a)){c=p[a.source],h=c.accessor.params.length;for(M=0,T=w.length;M<T;M++)o=w[M]*h,_.push((new s.Color).setRGB(c.data[o],c.data[o+1],c.data[o+2]))}var j,A,O=null,S=[];if(3===m)S.push(new s.Face3(w[0],w[1],w[2],x,_.length?_:new s.Color));else if(4===m)S.push(new s.Face3(w[0],w[1],w[3],x.length?[x[0].clone(),x[1].clone(),x[3].clone()]:[],_.length?[_[0],_[1],_[3]]:new s.Color)),S.push(new s.Face3(w[1],w[2],w[3],x.length?[x[1].clone(),x[2].clone(),x[3].clone()]:[],_.length?[_[1],_[2],_[3]]:new s.Color));else if(m>4&&N.subdivideFaces){var E=_.length?_:new s.Color;for(r=1;r<m-1;)S.push(new s.Face3(w[0],w[r],w[r+1],x.length?[x[0].clone(),x[r++].clone(),x[r].clone()]:[],E))}if(S.length)for(M=0,T=S.length;M<T;M++)for(O=S[M],O.daeMaterial=e.material,t.faces.push(O),r=0;r<g.length;r++)j=C[g[r]],A=m>4?[j[0],j[M+1],j[M+2]]:4===m?0===M?[j[0],j[1],j[3]]:[j[1].clone(),j[2],j[3].clone()]:[j[0],j[1],j[2]],void 0===t.faceVertexUvs[r]&&(t.faceVertexUvs[r]=[]),t.faceVertexUvs[r].push(A);else console.log("dropped face with vcount "+m+" for geometry with id: "+t.id);k+=f*m}}}},de.prototype.setVertices=function(e){for(var t=0;t<this.inputs.length;t++)this.inputs[t].source===e.id&&(this.inputs[t].source=e.input["POSITION"].source)},de.prototype.parse=function(e){this.material=e.getAttribute("material"),this.count=Be(e,"count",0);for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];switch(i.nodeName){case"input":this.inputs.push((new ve).parse(e.childNodes[t]));break;case"vcount":this.vcount=Fe(i.textContent);break;case"p":this.p.push(Fe(i.textContent));break;case"ph":console.warn("polygon holes not yet supported!");break;default:break}}return this},ue.prototype=Object.create(de.prototype),ue.prototype.constructor=ue,pe.prototype=Object.create(de.prototype),pe.prototype.constructor=pe,me.prototype=Object.create(de.prototype),me.prototype.constructor=me,fe.prototype.parse=function(e){this.params=[],this.source=e.getAttribute("source"),this.count=Be(e,"count",0),this.stride=Be(e,"stride",0);for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if("param"===i.nodeName){var s={};s["name"]=i.getAttribute("name"),s["type"]=i.getAttribute("type"),this.params.push(s)}}return this},ge.prototype.parse=function(e){this.id=e.getAttribute("id");for(var t=0;t<e.childNodes.length;t++)if("input"===e.childNodes[t].nodeName){var i=(new ve).parse(e.childNodes[t]);this.input[i.semantic]=i}return this},ve.prototype.parse=function(e){return this.semantic=e.getAttribute("semantic"),this.source=e.getAttribute("source").replace(/^#/,""),this.set=Be(e,"set",-1),this.offset=Be(e,"offset",0),"TEXCOORD"===this.semantic&&this.set<0&&(this.set=0),this},be.prototype.parse=function(e){this.id=e.getAttribute("id");for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];switch(i.nodeName){case"bool_array":this.data=Ve(i.textContent),this.type=i.nodeName;break;case"float_array":this.data=Ye(i.textContent),this.type=i.nodeName;break;case"int_array":this.data=Fe(i.textContent),this.type=i.nodeName;break;case"IDREF_array":case"Name_array":this.data=Xe(i.textContent),this.type=i.nodeName;break;case"technique_common":for(var s=0;s<i.childNodes.length;s++)if("accessor"===i.childNodes[s].nodeName){this.accessor=(new fe).parse(i.childNodes[s]);break}break;default:break}}return this},be.prototype.read=function(){var e=[],t=this.accessor.params[0];switch(t.type){case"IDREF":case"Name":case"name":case"float":return this.data;case"float4x4":for(var i=0;i<this.data.length;i+=16){var s=this.data.slice(i,i+16),r=$e(s);e.push(r)}break;default:console.log("ColladaLoader: Source: Read dont know how to read "+t.type+".");break}return e},ye.prototype.parse=function(e){this.id=e.getAttribute("id"),this.name=e.getAttribute("name");for(var t=0;t<e.childNodes.length;t++)if("instance_effect"===e.childNodes[t].nodeName){this.instance_effect=(new _e).parse(e.childNodes[t]);break}return this},ke.prototype.isColor=function(){return null===this.texture},ke.prototype.isTexture=function(){return null!=this.texture},ke.prototype.parse=function(e){"transparent"===e.nodeName&&(this.opaque=e.getAttribute("opaque"));for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"color":var r=Ye(i.textContent);this.color=new s.Color,this.color.setRGB(r[0],r[1],r[2]),this.color.a=r[3];break;case"texture":this.texture=i.getAttribute("texture"),this.texcoord=i.getAttribute("texcoord"),this.texOpts={offsetU:0,offsetV:0,repeatU:1,repeatV:1,wrapU:1,wrapV:1},this.parseTexture(i);break;default:break}}return this},ke.prototype.parseTexture=function(e){if(!e.childNodes)return this;e.childNodes[1]&&"extra"===e.childNodes[1].nodeName&&(e=e.childNodes[1],e.childNodes[1]&&"technique"===e.childNodes[1].nodeName&&(e=e.childNodes[1]));for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];switch(i.nodeName){case"offsetU":case"offsetV":case"repeatU":case"repeatV":this.texOpts[i.nodeName]=parseFloat(i.textContent);break;case"wrapU":case"wrapV":"TRUE"===i.textContent.toUpperCase()?this.texOpts[i.nodeName]=1:this.texOpts[i.nodeName]=parseInt(i.textContent);break;default:this.texOpts[i.nodeName]=i.textContent;break}}return this},we.prototype.parse=function(e){for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"emission":case"diffuse":case"specular":case"transparent":this[i.nodeName]=(new ke).parse(i);break;case"bump":var s=i.getAttribute("bumptype");s?"heightfield"===s.toLowerCase()?this["bump"]=(new ke).parse(i):"normalmap"===s.toLowerCase()?this["normal"]=(new ke).parse(i):(console.error("Shader.prototype.parse: Invalid value for attribute 'bumptype' ("+s+") - valid bumptypes are 'HEIGHTFIELD' and 'NORMALMAP' - defaulting to 'HEIGHTFIELD'"),this["bump"]=(new ke).parse(i)):(console.warn("Shader.prototype.parse: Attribute 'bumptype' missing from bump node - defaulting to 'HEIGHTFIELD'"),this["bump"]=(new ke).parse(i));break;case"shininess":case"reflectivity":case"index_of_refraction":case"transparency":var r=i.querySelectorAll("float");r.length>0&&(this[i.nodeName]=parseFloat(r[0].textContent));break;default:break}}return this.create(),this},we.prototype.create=function(){var e={},t=!1;if(void 0!==this["transparency"]&&void 0!==this["transparent"]){this["transparent"];var i=(this.transparent.color.r+this.transparent.color.g+this.transparent.color.b)/3*this.transparency;i>0&&(t=!0,e["transparent"]=!0,e["opacity"]=1-i)}var r={diffuse:"map",ambient:"lightMap",specular:"specularMap",emission:"emissionMap",bump:"bumpMap",normal:"normalMap"};for(var a in this)switch(a){case"ambient":case"emission":case"diffuse":case"specular":case"bump":case"normal":var n=this[a];if(n instanceof ke)if(n.isTexture()){var c=n.texture,h=this.effect.sampler[c];if(void 0!==h&&void 0!==h.source){var l=this.effect.surface[h.source];if(void 0!==l){var d=m[l.init_from];if(d){var u,p=o+d.init_from,f=s.Loader.Handlers.get(p);null!==f?u=f.load(p):(u=new s.Texture,Ze(u,p)),u.wrapS=n.texOpts.wrapU?s.RepeatWrapping:s.ClampToEdgeWrapping,u.wrapT=n.texOpts.wrapV?s.RepeatWrapping:s.ClampToEdgeWrapping,u.offset.x=n.texOpts.offsetU,u.offset.y=n.texOpts.offsetV,u.repeat.x=n.texOpts.repeatU,u.repeat.y=n.texOpts.repeatV,e[r[a]]=u,"emission"===a&&(e["emissive"]=16777215)}}}}else"diffuse"!==a&&t||("emission"===a?e["emissive"]=n.color.getHex():e[a]=n.color.getHex());break;case"shininess":e[a]=this[a];break;case"reflectivity":e[a]=this[a],e[a]>0&&(e["envMap"]=N.defaultEnvMap),e["combine"]=s.MixOperation;break;case"index_of_refraction":e["refractionRatio"]=this[a],1!==this[a]&&(e["envMap"]=N.defaultEnvMap);break;case"transparency":break;default:break}switch(e["shading"]=x,e["side"]=this.effect.doubleSided?s.DoubleSide:s.FrontSide,void 0!==e.diffuse&&(e.color=e.diffuse,delete e.diffuse),this.type){case"constant":void 0!=e.emissive&&(e.color=e.emissive),this.material=new s.MeshBasicMaterial(e);break;case"phong":case"blinn":this.material=new s.MeshPhongMaterial(e);break;case"lambert":default:this.material=new s.MeshLambertMaterial(e);break}return this.material},xe.prototype.parse=function(e){for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"init_from":this.init_from=i.textContent;break;case"format":this.format=i.textContent;break;default:console.log("unhandled Surface prop: "+i.nodeName);break}}return this},Ne.prototype.parse=function(e){for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"source":this.source=i.textContent;break;case"minfilter":this.minfilter=i.textContent;break;case"magfilter":this.magfilter=i.textContent;break;case"mipfilter":this.mipfilter=i.textContent;break;case"wrap_s":this.wrap_s=i.textContent;break;case"wrap_t":this.wrap_t=i.textContent;break;default:console.log("unhandled Sampler2D prop: "+i.nodeName);break}}return this},Ce.prototype.create=function(){if(null===this.shader)return null},Ce.prototype.parse=function(e){this.id=e.getAttribute("id"),this.name=e.getAttribute("name"),Ue(this,e),this.shader=null;for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"profile_COMMON":this.parseTechnique(this.parseProfileCOMMON(i));break;default:break}}return this},Ce.prototype.parseNewparam=function(e){for(var t=e.getAttribute("sid"),i=0;i<e.childNodes.length;i++){var s=e.childNodes[i];if(1==s.nodeType)switch(s.nodeName){case"surface":this.surface[t]=new xe(this).parse(s);break;case"sampler2D":this.sampler[t]=new Ne(this).parse(s);break;case"extra":break;default:console.log(s.nodeName);break}}},Ce.prototype.parseProfileCOMMON=function(e){for(var t,i=0;i<e.childNodes.length;i++){var s=e.childNodes[i];if(1==s.nodeType)switch(s.nodeName){case"profile_COMMON":this.parseProfileCOMMON(s);break;case"technique":t=s;break;case"newparam":this.parseNewparam(s);break;case"image":var r=(new Q).parse(s);m[r.id]=r;break;case"extra":break;default:console.log(s.nodeName);break}}return t},Ce.prototype.parseTechnique=function(e){for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"constant":case"lambert":case"blinn":case"phong":this.shader=new we(i.nodeName,this).parse(i);break;case"extra":this.parseExtra(i);break;default:break}}},Ce.prototype.parseExtra=function(e){for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"technique":this.parseExtraTechnique(i);break;default:break}}},Ce.prototype.parseExtraTechnique=function(e){for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"bump":this.shader.parse(e);break;default:break}}},_e.prototype.parse=function(e){return this.url=e.getAttribute("url").replace(/^#/,""),this},Me.prototype.parse=function(e){this.id=e.getAttribute("id"),this.name=e.getAttribute("name"),this.source={};for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"animation":var s=(new Me).parse(i);for(var r in s.source)this.source[r]=s.source[r];for(var a=0;a<s.channel.length;a++)this.channel.push(s.channel[a]),this.sampler.push(s.sampler[a]);break;case"source":r=(new be).parse(i);this.source[r.id]=r;break;case"sampler":this.sampler.push(new je(this).parse(i));break;case"channel":this.channel.push(new Te(this).parse(i));break;default:break}}return this},Te.prototype.parse=function(e){this.source=e.getAttribute("source").replace(/^#/,""),this.target=e.getAttribute("target");var t=this.target.split("/"),i=(t.shift(),t.shift()),s=i.indexOf(".")>=0,r=i.indexOf("(")>=0;if(s)t=i.split("."),this.sid=t.shift(),this.member=t.shift();else if(r){var a=i.split("(");this.sid=a.shift();for(var n=0;n<a.length;n++)a[n]=parseInt(a[n].replace(/\)/,""));this.arrIndices=a}else this.sid=i;return this.fullSid=i,this.dotSyntax=s,this.arrSyntax=r,this},je.prototype.parse=function(e){this.id=e.getAttribute("id"),this.inputs=[];for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"input":this.inputs.push((new ve).parse(i));break;default:break}}return this},je.prototype.create=function(){for(var e=0;e<this.inputs.length;e++){var t=this.inputs[e],i=this.animation.source[t.source];switch(t.semantic){case"INPUT":this.input=i.read();break;case"OUTPUT":this.output=i.read(),this.strideOut=i.accessor.stride;break;case"INTERPOLATION":this.interpolation=i.read();break;case"IN_TANGENT":break;case"OUT_TANGENT":break;default:console.log(t.semantic);break}}if(this.startTime=0,this.endTime=0,this.duration=0,this.input.length){this.startTime=1e8,this.endTime=-1e8;for(e=0;e<this.input.length;e++)this.startTime=Math.min(this.startTime,this.input[e]),this.endTime=Math.max(this.endTime,this.input[e]);this.duration=this.endTime-this.startTime}},je.prototype.getData=function(e,t,i){var s;if("matrix"===e&&16===this.strideOut)s=this.output[t];else if(this.strideOut>1){s=[],t*=this.strideOut;for(var r=0;r<this.strideOut;++r)s[r]=this.output[t+r];if(3===this.strideOut)switch(e){case"rotate":case"translate":Ge(s,-1);break;case"scale":Ge(s,1);break}else 4===this.strideOut&&"matrix"===e&&Ge(s,-1)}else s=this.output[t],i&&"translate"===e&&(s=Je(i,s));return s},Ae.prototype.addTarget=function(e,t,i,s){this.targets.push({sid:e,member:i,transform:t,data:s})},Ae.prototype.apply=function(e){for(var t=0;t<this.targets.length;++t){var i=this.targets[t];e&&i.sid!==e||i.transform.update(i.data,i.member)}},Ae.prototype.getTarget=function(e){for(var t=0;t<this.targets.length;++t)if(this.targets[t].sid===e)return this.targets[t];return null},Ae.prototype.hasTarget=function(e){for(var t=0;t<this.targets.length;++t)if(this.targets[t].sid===e)return!0;return!1},Ae.prototype.interpolate=function(e,t){for(var i=0,s=this.targets.length;i<s;i++){var r,a=this.targets[i],n=e.getTarget(a.sid);if("matrix"!==a.transform.type&&n){var o=(t-this.time)/(e.time-this.time),c=n.data,h=a.data;if(o<0&&(o=0),o>1&&(o=1),h.length){r=[];for(var l=0;l<h.length;++l)r[l]=h[l]+(c[l]-h[l])*o}else r=h+(c-h)*o}else r=a.data;a.transform.update(r,a.member)}},Oe.prototype.parse=function(e){this.id=e.getAttribute("id"),this.name=e.getAttribute("name");for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"optics":this.parseOptics(i);break;default:break}}return this},Oe.prototype.parseOptics=function(e){for(var t=0;t<e.childNodes.length;t++)if("technique_common"===e.childNodes[t].nodeName)for(var i=e.childNodes[t],s=0;s<i.childNodes.length;s++)if(this.technique=i.childNodes[s].nodeName,"perspective"===this.technique)for(var r=i.childNodes[s],a=0;a<r.childNodes.length;a++){var n=r.childNodes[a];switch(n.nodeName){case"yfov":this.yfov=n.textContent;break;case"xfov":this.xfov=n.textContent;break;case"znear":this.znear=n.textContent;break;case"zfar":this.zfar=n.textContent;break;case"aspect_ratio":this.aspect_ratio=n.textContent;break}}else if("orthographic"===this.technique){var o=i.childNodes[s];for(a=0;a<o.childNodes.length;a++){n=o.childNodes[a];switch(n.nodeName){case"xmag":this.xmag=n.textContent;break;case"ymag":this.ymag=n.textContent;break;case"znear":this.znear=n.textContent;break;case"zfar":this.zfar=n.textContent;break;case"aspect_ratio":this.aspect_ratio=n.textContent;break}}}return this},Se.prototype.parse=function(e){return this.url=e.getAttribute("url").replace(/^#/,""),this},Ee.prototype.parse=function(e){this.id=e.getAttribute("id"),this.name=e.getAttribute("name");for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"technique_common":this.parseCommon(i);break;case"technique":this.parseTechnique(i);break;default:break}}return this},Ee.prototype.parseCommon=function(e){for(var t=0;t<e.childNodes.length;t++)switch(e.childNodes[t].nodeName){case"directional":case"point":case"spot":case"ambient":this.technique=e.childNodes[t].nodeName;for(var i=e.childNodes[t],r=0;r<i.childNodes.length;r++){var a=i.childNodes[r];switch(a.nodeName){case"color":var n=Ye(a.textContent);this.color=new s.Color(0),this.color.setRGB(n[0],n[1],n[2]),this.color.a=n[3];break;case"falloff_angle":this.falloff_angle=parseFloat(a.textContent);break;case"quadratic_attenuation":var o=parseFloat(a.textContent);this.distance=o?Math.sqrt(1/o):0}}}return this},Ee.prototype.parseTechnique=function(e){this.profile=e.getAttribute("profile");for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];switch(i.nodeName){case"intensity":this.intensity=parseFloat(i.textContent);break}}return this},Le.prototype.parse=function(e){return this.url=e.getAttribute("url").replace(/^#/,""),this},Ie.prototype.parse=function(e){this.id=e.getAttribute("id"),this.name=e.getAttribute("name"),this.joints=[],this.links=[];for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"technique_common":this.parseCommon(i);break;default:break}}return this},Ie.prototype.parseCommon=function(e){for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(e.childNodes[t].nodeName){case"joint":this.joints.push((new qe).parse(i));break;case"link":this.links.push((new ze).parse(i));break;default:break}}return this},qe.prototype.parse=function(e){this.sid=e.getAttribute("sid"),this.name=e.getAttribute("name"),this.axis=new s.Vector3,this.limits={min:0,max:0},this.type="",this.static=!1,this.zeroPosition=0,this.middlePosition=0;var t=e.querySelector("axis"),i=Ye(t.textContent);this.axis=We(i,0);var r=e.querySelector("limits min")?parseFloat(e.querySelector("limits min").textContent):-360,a=e.querySelector("limits max")?parseFloat(e.querySelector("limits max").textContent):360;this.limits={min:r,max:a};for(var n=["prismatic","revolute"],o=0;o<n.length;o++){var c=n[o],h=e.querySelector(c);h&&(this.type=c)}return this.limits.min>=this.limits.max&&(this.static=!0),this.middlePosition=(this.limits.min+this.limits.max)/2,this},ze.prototype.parse=function(e){this.sid=e.getAttribute("sid"),this.name=e.getAttribute("name"),this.transforms=[],this.attachments=[];for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"attachment_full":this.attachments.push((new Pe).parse(i));break;case"rotate":case"translate":case"matrix":this.transforms.push((new ae).parse(i));break;default:break}}return this},Pe.prototype.parse=function(e){this.joint=e.getAttribute("joint").split("/").pop(),this.links=[];for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"link":this.links.push((new ze).parse(i));break;case"rotate":case"translate":case"matrix":this.transforms.push((new ae).parse(i));break;default:break}}return this},{load:T,parse:j,setPreferredShading:A,applySkin:X,geometries:v,options:N}};e.exports=r}}]);
//# sourceMappingURL=chunk-7352cf6f.ad74a703.js.map